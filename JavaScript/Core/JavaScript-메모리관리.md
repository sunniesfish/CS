# JavaScript 메모리 관리

## 목차

- [[#메모리 구조의 기본 개념]]
  - [[#메모리 구조의 기본 개념#1. 메모리 영역]]
  - [[#메모리 구조의 기본 개념#2. 상위/하위 주소]]
- [[#가상 메모리]]
  - [[#가상 메모리#1. 개념과 동작]]
  - [[#가상 메모리#2. 페이징]]
  - [[#가상 메모리#3. 프로세스별 주소 사용]]
  - [[#가상 메모리#4. 페이징 처리 과정]]
- [[#JavaScript의 가비지 컬렉션(GC)]]
  - [[#JavaScript의 가비지 컬렉션(GC)#1. 기본 원리]]
  - [[#JavaScript의 가비지 컬렉션(GC)#2. GC 최적화 방법]]
  - [[#JavaScript의 가비지 컬렉션(GC)#3. Node.js GC 강제 호출 (실험적)]]
  - [[#JavaScript의 가비지 컬렉션(GC)#4. JavaScript와 가상 메모리]]
- [[#메모리 누수 방지]]
- [[#관련 문서]]

## 메모리 구조의 기본 개념

### 1. 메모리 영역

- **코드(텍스트)**: 실행 파일의 코드 저장
- **데이터**: 초기화된 전역 변수, 정적 변수
- **BSS**: 초기화되지 않은 전역 변수, 정적 변수
- **힙(Heap)**: 동적 메모리 할당, 위쪽으로 증가
- **스택(Stack)**: 함수 호출 시 지역 변수와 반환 주소, 아래쪽으로 감소

### 2. 상위/하위 주소

- **상위주소**: 더 큰 주소값 (메모리 상단 영역)
- **하위주소**: 더 작은 주소값 (메모리 하단 영역)
- 메모리 구조는 상대적 개념으로 운영체제가 관리

## 가상 메모리

### 1. 개념과 동작

- 물리 메모리와 보조기억장치를 결합하여 사용
- **페이지 테이블**로 가상 주소를 물리 주소로 변환
- 각 프로세스는 독립적인 가상 주소 공간 보유

### 2. 페이징

- 물리 메모리를 **페이지 프레임**으로 분할
- 가상 메모리를 **페이지**로 분할하여 매핑
- **장점**: 메모리 조각화 방지, 효율적인 메모리 사용

### 3. 프로세스별 주소 사용

- 각 프로세스는 동일한 가상 주소 사용 가능
- 프로세스별 페이지 테이블로 독립적 매핑
- 시스템 콜(execve)로 가상 메모리 초기화

### 4. 페이징 처리 과정

- CPU가 가상 주소 요청
- 페이지 테이블에서 물리 주소 검색
- **페이지 히트**: 메모리에 있는 페이지 바로 접근
- **페이지 폴트**: 디스크에서 필요한 페이지 로드
- 운영체제는 커널 모드에서 페이지 테이블 관리
- 사용하지 않는 페이지 디스크로 스왑

## JavaScript의 가비지 컬렉션(GC)

### 1. 기본 원리

- 자동 메모리 관리 제공
- **Mark-and-Sweep 알고리즘** 사용
  - **Mark**: 참조되는 객체를 "활성" 상태로 표시
  - **Sweep**: 참조되지 않는 객체를 메모리에서 해제

### 2. GC 최적화 방법

1. **불필요한 참조 제거**

```javascript
let obj = { key: "value" };
obj = null; // 참조 해제
```

2. **전역 객체 사용 최소화**

```javascript
function scopeExample() {
  let temp = "local variable";
}
```

3. **객체 풀링 활용**

```javascript
const pool = [];
function getObject() {
  return pool.length > 0 ? pool.pop() : {};
}
function releaseObject(obj) {
  pool.push(obj);
}
```

### 3. Node.js GC 강제 호출 (실험적)

```javascript
// --expose-gc 플래그 필요
global.gc();
console.log("GC executed.");
```

### 4. JavaScript와 가상 메모리

- JavaScript는 **런타임 엔진(V8)**이 메모리 관리
- 각 JavaScript 런타임은 고유한 가상 메모리 공간 가짐
- 힙 메모리는 가상 주소로 관리되며 물리 메모리에 매핑
- GC 과정에서 참조되지 않는 객체 해제로 페이지 폴트 최적화

## 메모리 누수 방지

- **이벤트 리스너 미제거** 주의
- **클로저의 불필요한 참조** 관리
- **전역 변수** 최소화
- 큰 객체는 사용 후 **null 처리**

## 관련 문서

- [[JavaScript-기본개념]]
- [[JavaScript-싱글스레드와-멀티스레드]]

#javascript #memory #gc #performance
